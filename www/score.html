<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
  <script src="components/loader.js"></script>
  <!-- <script src="js/app.js"></script> -->
  <script src="lib/onsenui/js/onsenui.min.js"></script>
  <script src="components/ncmb/ncmb.min.js"></script>

  <link rel="stylesheet" href="components/loader.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsenui.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsen-css-components.css">
  <link rel="stylesheet" href="css/style.css">

  <script>
    // Page init event
    // SDKを利用するためのコード(成績保持のために使う)
    var ncmb = new NCMB("ad3da03c7c0dbd222b0e7f0b7d891e9de2f79acda2dd3cdbf606a92687b13af5","e6b5108ec940908467b82b77bbc622e1c67fba5ca4ccc48202672bf769192839");
    var APPLICATION_ID = "Gn00hca1AEsKkkLY";

    document.addEventListener('init', function(event) {
      var page = event.target;

      var resultYayoi = [];
      var resultAsuka = [];
      var resultNara = [];
      var resultHeian = [];
      var resultKamakura = [];
      var resultMuromachi = [];
      var resultMomoyama = [];
      var resultEdo = [];
      var resultMeiji = [];
      var resultTaisyo = [];
      var resultSenzen = [];
      var resultSengo = [];

      if (page.matches('#score-top-page')) {
        var scoreRate = ncmb.DataStore("ScoreRate");
        scoreRate.limit(50)
        .fetchAll()
        .then(function(results){
          // 結果取得後の処理を書いていく。⇒配列に代入する？
          // 全部抜き出す？⇒最新5つ分とすべての平均の％を表示
          for (var i = 0; i < results.length; i++) {
          resultYayoi.push(results[i].yayoi);
          resultAsuka.push(results[i].asuka);
          resultNara.push(results[i].nara);
          resultHeian.push(results[i].heian);
          resultKamakura.push(results[i].kamakura);
          resultMuromachi.push(results[i].muromachi);
          resultMomoyama.push(results[i].momoyama);
          resultEdo.push(results[i].edo);
          resultMeiji.push(results[i].meiji);
          resultTaisyo.push(results[i].taisyo);
          resultSenzen.push(results[i].senzen);
          resultSengo.push(results[i].sengo);
          // var resultDate = results[i].createDate;
          }

          // 各時代の平均正答率を出す処理↓
          // 関数にできないのかね？変数だからうまくいかなかったんだけど
          var allYayoiScore = 0;
          for (let i=0; i<resultYayoi.length; i++) {
            allYayoiScore += resultYayoi[i];
          }
          var yayoiAvg = Math.round(allYayoiScore / resultYayoi.length);

          var allAsukaScore = 0;
          for (let i=0; i<resultAsuka.length; i++) {
            allAsukaScore += resultAsuka[i];
          }
          var asukaAvg = Math.round(allAsukaScore / resultAsuka.length);

          var allNaraScore = 0;
          for (let i=0; i<resultNara.length; i++) {
            allNaraScore += resultNara[i];
          }
          var naraAvg = Math.round(allNaraScore / resultNara.length);

          var allHeianScore = 0;
          for (let i=0; i<resultHeian.length; i++) {
            allHeianScore += resultHeian[i];
          }
          var heianAvg = Math.round(allHeianScore / resultHeian.length);

          var allKamakuraScore = 0;
          for (let i=0; i<resultKamakura.length; i++) {
            allKamakuraScore += resultKamakura[i];
          }
          var kamakuraAvg = Math.round(allKamakuraScore / resultKamakura.length);

          var allMuromachiScore = 0;
          for (let i=0; i<resultMuromachi.length; i++) {
            allMuromachiScore += resultMuromachi[i];
          }
          var muromachiAvg = Math.round(allMuromachiScore / resultMuromachi.length);

          var allMomoyamaScore = 0;
          for (let i=0; i<resultMomoyama.length; i++) {
            allMomoyamaScore += resultMomoyama[i];
          }
          var momoyamaAvg = Math.round(allMomoyamaScore / resultMomoyama.length);

          var allEdoScore = 0;
          for (let i=0; i<resultEdo.length; i++) {
            allEdoScore += resultEdo[i];
          }
          var edoAvg = Math.round(allEdoScore / resultEdo.length);

          var allMeijiScore = 0;
          for (let i=0; i<resultMeiji.length; i++) {
            allMeijiScore += resultMeiji[i];
          }
          var meijiAvg = Math.round(allMeijiScore / resultMeiji.length);

          var allTaisyoScore = 0;
          for (let i=0; i<resultTaisyo.length; i++) {
            allTaisyoScore += resultTaisyo[i];
          }
          var taisyoAvg = Math.round(allTaisyoScore / resultTaisyo.length);

          var allSenzenScore = 0;
          for (let i=0; i<resultSenzen.length; i++) {
            allSenzenScore += resultSenzen[i];
          }
          var senzenAvg = Math.round(allSenzenScore / resultSenzen.length);

          var allSengoScore = 0;
          for (let i=0; i<resultSengo.length; i++) {
            allSengoScore += resultSengo[i];
          }
          var sengoAvg = Math.round(allSengoScore / resultSengo.length);

          document.getElementById('yAvg').textContent = yayoiAvg;
          document.getElementById('aAvg').textContent = asukaAvg;
          document.getElementById('nAvg').textContent = naraAvg;
          document.getElementById('hAvg').textContent = heianAvg;
          document.getElementById('kAvg').textContent = kamakuraAvg;
          document.getElementById('mrAvg').textContent = muromachiAvg;
          document.getElementById('amAvg').textContent = momoyamaAvg;
          document.getElementById('eAvg').textContent = edoAvg;
          document.getElementById('mjAvg').textContent = meijiAvg;
          document.getElementById('tAvg').textContent = taisyoAvg;
          document.getElementById('sbAvg').textContent = senzenAvg;
          document.getElementById('saAvg').textContent = sengoAvg;
          // 各時代の平均正答率を出す処理↑

          // 各時代の実施回ごとの正答率を出す処理↓
          // 正答率の配列の最新5個を出力
          var resultYayoiOrder = resultYayoi.slice(-5);
          var resultAsukaOrder = resultAsuka.slice(-5);
          var resultNaraOrder = resultNara.slice(-5);
          var resultHeianOrder = resultHeian.slice(-5);
          var resultKamakuraOrder = resultKamakura.slice(-5);
          var resultMuromachiOrder = resultMuromachi.slice(-5);
          var resultMomoyamaOrder = resultMomoyama.slice(-5);
          var resultEdoOrder = resultEdo.slice(-5);
          var resultMeijiOrder = resultMeiji.slice(-5);
          var resultTaisyoOrder = resultTaisyo.slice(-5);
          var resultSenzenOrder = resultSenzen.slice(-5);
          var resultSengoOrder = resultSengo.slice(-5);

          // 弥生時代を表に入れる
          document.getElementById('Y1').textContent = resultYayoiOrder[4];
          document.getElementById('Y2').textContent = resultYayoiOrder[3];
          document.getElementById('Y3').textContent = resultYayoiOrder[2];
          document.getElementById('Y4').textContent = resultYayoiOrder[1];
          document.getElementById('Y5').textContent = resultYayoiOrder[0];
          
          // 飛鳥時代を表に入れる
          document.getElementById('A1').textContent = resultAsukaOrder[4];
          document.getElementById('A2').textContent = resultAsukaOrder[3];
          document.getElementById('A3').textContent = resultAsukaOrder[2];
          document.getElementById('A4').textContent = resultAsukaOrder[1];
          document.getElementById('A5').textContent = resultAsukaOrder[0];

          // 奈良時代を表に入れる
          document.getElementById('N1').textContent = resultNaraOrder[4];
          document.getElementById('N2').textContent = resultNaraOrder[3];
          document.getElementById('N3').textContent = resultNaraOrder[2];
          document.getElementById('N4').textContent = resultNaraOrder[1];
          document.getElementById('N5').textContent = resultNaraOrder[0];

          // 平安時代を表に入れる
          document.getElementById('H1').textContent = resultHeianOrder[4];
          document.getElementById('H2').textContent = resultHeianOrder[3];
          document.getElementById('H3').textContent = resultHeianOrder[2];
          document.getElementById('H4').textContent = resultHeianOrder[1];
          document.getElementById('H5').textContent = resultHeianOrder[0];

          // 鎌倉時代を表に入れる
          document.getElementById('K1').textContent = resultKamakuraOrder[4];
          document.getElementById('K2').textContent = resultKamakuraOrder[3];
          document.getElementById('K3').textContent = resultKamakuraOrder[2];
          document.getElementById('K4').textContent = resultKamakuraOrder[1];
          document.getElementById('K5').textContent = resultKamakuraOrder[0];

          // 室町時代を表に入れる
          document.getElementById('MR1').textContent = resultMuromachiOrder[4];
          document.getElementById('MR2').textContent = resultMuromachiOrder[3];
          document.getElementById('MR3').textContent = resultMuromachiOrder[2];
          document.getElementById('MR4').textContent = resultMuromachiOrder[1];
          document.getElementById('MR5').textContent = resultMuromachiOrder[0];

          // 安土桃山時代を表に入れる
          document.getElementById('AM1').textContent = resultMomoyamaOrder[4];
          document.getElementById('AM2').textContent = resultMomoyamaOrder[3];
          document.getElementById('AM3').textContent = resultMomoyamaOrder[2];
          document.getElementById('AM4').textContent = resultMomoyamaOrder[1];
          document.getElementById('AM5').textContent = resultMomoyamaOrder[0];

          // 江戸時代を表に入れる
          document.getElementById('E1').textContent = resultEdoOrder[4];
          document.getElementById('E2').textContent = resultEdoOrder[3];
          document.getElementById('E3').textContent = resultEdoOrder[2];
          document.getElementById('E4').textContent = resultEdoOrder[1];
          document.getElementById('E5').textContent = resultEdoOrder[0];

          // 明治時代を表に入れる
          document.getElementById('MJ1').textContent = resultMeijiOrder[4];
          document.getElementById('MJ2').textContent = resultMeijiOrder[3];
          document.getElementById('MJ3').textContent = resultMeijiOrder[2];
          document.getElementById('MJ4').textContent = resultMeijiOrder[1];
          document.getElementById('MJ5').textContent = resultMeijiOrder[0];

          // 大正時代を表に入れる
          document.getElementById('T1').textContent = resultTaisyoOrder[4];
          document.getElementById('T2').textContent = resultTaisyoOrder[3];
          document.getElementById('T3').textContent = resultTaisyoOrder[2];
          document.getElementById('T4').textContent = resultTaisyoOrder[1];
          document.getElementById('T5').textContent = resultTaisyoOrder[0];

          // 昭和{戦前)時代を表に入れる
          document.getElementById('SB1').textContent = resultSenzenOrder[4];
          document.getElementById('SB2').textContent = resultSenzenOrder[3];
          document.getElementById('SB3').textContent = resultSenzenOrder[2];
          document.getElementById('SB4').textContent = resultSenzenOrder[1];
          document.getElementById('SB5').textContent = resultSenzenOrder[0];

          // 昭和{戦後)時代を表に入れる
          document.getElementById('SA1').textContent = resultSengoOrder[4];
          document.getElementById('SA2').textContent = resultSengoOrder[3];
          document.getElementById('SA3').textContent = resultSengoOrder[2];
          document.getElementById('SA4').textContent = resultSengoOrder[1];
          document.getElementById('SA5').textContent = resultSengoOrder[0];
          // 各時代の実施回ごとの正答率を出す処理↑
        })
        .catch(function(err){
          console.log("テスト結果を取得できませんでした");
        });


      } 

    });

    if (ons.platform.isIPhoneX()) {
      document.documentElement.setAttribute('onsflag-iphonex-portrait', '');
      document.documentElement.setAttribute('onsflag-iphonex-landscape', '');
    }
  </script>
</head>
<body>
  <ons-navigator id="navigator" page="score-top.html"></ons-navigator>

  <ons-template id="score-top.html">
    <ons-page id="score-top-page"  class="top">
  
      <ons-toolbar>
        <div class="center">これまでの成績</div>
      </ons-toolbar>

      <div class="scoreTable">
        <p>過去5回分の正答率一覧</p>
    
        <table>
          <thead>
            <tr>
              <th></th>
              <th>前回</th>
              <th>2</th>
              <th>3</th>
              <th>4</th>
              <th>5</th>
              <th>累計</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th>弥生</th>
              <td><span id="Y1"></span></td>
              <td><span id="Y2"></span></td>
              <td><span id="Y3"></span></td>
              <td><span id="Y4"></span></td>
              <td><span id="Y5"></span></td>
              <td><span id="yAvg"></span>%</td>
            </tr>
            <tr>
              <th>飛鳥</th>
              <td><span id="A1"></span></td>
              <td><span id="A2"></span></td>
              <td><span id="A3"></span></td>
              <td><span id="A4"></span></td>
              <td><span id="A5"></span></td>
              <td><span id="aAvg"></span>%</td>
            </tr>
            <tr>
              <th>奈良</th>
              <td><span id="N1"></span></td>
              <td><span id="N2"></span></td>
              <td><span id="N3"></span></td>
              <td><span id="N4"></span></td>
              <td><span id="N5"></span></td>
              <td><span id="nAvg"></span>%</td>
            </tr>
            <tr>
              <th>平安</th>
              <td><span id="H1"></span></td>
              <td><span id="H2"></span></td>
              <td><span id="H3"></span></td>
              <td><span id="H4"></span></td>
              <td><span id="H5"></span></td>
              <td><span id="hAvg"></span>%</td>
            </tr>
            <tr>
              <th>鎌倉</th>
              <td><span id="K1"></span></td>
              <td><span id="K2"></span></td>
              <td><span id="K3"></span></td>
              <td><span id="K4"></span></td>
              <td><span id="K5"></span></td>
              <td><span id="kAvg"></span>%</td>
            </tr>
            <tr>
              <th>室町</th>
              <td><span id="MR1"></span></td>
              <td><span id="MR2"></span></td>
              <td><span id="MR3"></span></td>
              <td><span id="MR4"></span></td>
              <td><span id="MR5"></span></td>
              <td><span id="mrAvg"></span>%</td>
            </tr>
            <tr>
              <th>安土<br>桃山</th>
              <td><span id="AM1"></span></td>
              <td><span id="AM2"></span></td>
              <td><span id="AM3"></span></td>
              <td><span id="AM4"></span></td>
              <td><span id="AM5"></span></td>
              <td><span id="amAvg"></span>%</td>
            </tr>
            <tr>
              <th>江戸</th>
              <td><span id="E1"></span></td>
              <td><span id="E2"></span></td>
              <td><span id="E3"></span></td>
              <td><span id="E4"></span></td>
              <td><span id="E5"></span></td>
              <td><span id="eAvg"></span>%</td>
            </tr>
            <tr>
              <th>明治</th>
              <td><span id="MJ1"></span></td>
              <td><span id="MJ2"></span></td>
              <td><span id="MJ3"></span></td>
              <td><span id="MJ4"></span></td>
              <td><span id="MJ5"></span></td>
              <td><span id="mjAvg"></span>%</td>
            </tr>
            <tr>
              <th>大正</th>
              <td><span id="T1"></span></td>
              <td><span id="T2"></span></td>
              <td><span id="T3"></span></td>
              <td><span id="T4"></span></td>
              <td><span id="T5"></span></td>
              <td><span id="tAvg"></span>%</td>
            </tr>
            <tr>
              <th>戦前</th>
              <td><span id="SB1"></span></td>
              <td><span id="SB2"></span></td>
              <td><span id="SB3"></span></td>
              <td><span id="SB4"></span></td>
              <td><span id="SB5"></span></td>
              <td><span id="sbAvg"></span>%</td>
            </tr>
            <tr>
              <th>戦後</th>
              <td><span id="SA1"></span></td>
              <td><span id="SA2"></span></td>
              <td><span id="SA3"></span></td>
              <td><span id="SA4"></span></td>
              <td><span id="SA5"></span></td>
              <td><span id="saAvg"></span>%</td>
            </tr>
          </tbody>
        </table>
      </div>
  
      <footer>
        <a href="index.html" class="top-btn btn">TOPへ戻る</a>
      </footer>
    </ons-page>
  
   </ons-template>
</body>
</html>